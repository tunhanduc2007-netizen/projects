---
description: Há»‡ thá»‘ng Mua hÃ ng & Äáº·t hÃ ng Online - CLB BÃ³ng BÃ n LÃª QuÃ½ ÄÃ´n
---

# ğŸ›’ Há»† THá»NG MUA HÃ€NG & Äáº¶T HÃ€NG ONLINE

## 1ï¸âƒ£ SÆ  Äá»’ LUá»’NG Äáº¶T HÃ€NG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LUá»’NG Äáº¶T HÃ€NG                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[KhÃ¡ch hÃ ng]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Xem sáº£n pháº©m â”‚
â”‚ (Danh má»¥c)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chi tiáº¿t SP  â”‚
â”‚ + Chá»n SL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nháº­p thÃ´ng tin Ä‘áº·t hÃ ng      â”‚
â”‚ â€¢ Há» tÃªn                     â”‚
â”‚ â€¢ Sá»‘ Ä‘iá»‡n thoáº¡i              â”‚
â”‚ â€¢ Ghi chÃº (tuá»³ chá»n)         â”‚
â”‚ â€¢ Chá»n: QR Code / Banking    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API: POST /shop/orders       â”‚
â”‚ â†’ Táº¡o Ä‘Æ¡n + MÃ£ Ä‘Æ¡n hÃ ng      â”‚
â”‚ â†’ Táº¡o ná»™i dung CK            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hiá»ƒn thá»‹ TRANG THANH TOÃN                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ QR Code (VietQR)                                 â”‚ â”‚
â”‚ â”‚ NgÃ¢n hÃ ng: ACB                                   â”‚ â”‚
â”‚ â”‚ STK: 6200167                                     â”‚ â”‚
â”‚ â”‚ Chá»§ TK: TU NHAN LUAN                             â”‚ â”‚
â”‚ â”‚ Ná»™i dung: CLBLQD_ORD123456                       â”‚ â”‚
â”‚ â”‚ Sá»‘ tiá»n: 1,300,000 VNÄ                           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Hotline: 0937 009 075                            â”‚ â”‚
â”‚ â”‚ Tráº¡ng thÃ¡i: CHá»œ THANH TOÃN                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€ KhÃ¡ch chuyá»ƒn khoáº£n â”€â”€â”€â”
     â”‚                          â”‚
     â–¼                          â–¼
[Admin kiá»ƒm tra]          [Tra cá»©u Ä‘Æ¡n hÃ ng]
     â”‚                          â”‚
     â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ XÃ¡c nháº­n     â”‚               â”‚
â”‚ Ä‘Ã£ nháº­n tiá»n â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
     â”‚                          â”‚
     â–¼                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ Cáº­p nháº­t     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Tráº¡ng thÃ¡i   â”‚
â”‚ â†’ ÄÃ£ TT      â”‚
â”‚ â†’ ÄÃ£ xÃ¡c nháº­nâ”‚
â”‚ â†’ HoÃ n táº¥t   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2ï¸âƒ£ DATABASE SCHEMA

```sql
-- =====================================================
-- Báº¢NG PRODUCTS (Sáº£n pháº©m)
-- =====================================================
CREATE TABLE shop_products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) UNIQUE NOT NULL,
    brand VARCHAR(100),
    category VARCHAR(50) NOT NULL,
    -- 'mat-vot', 'cot-vot', 'vot-hoan-chinh', 'bong', 'phu-kien'
    price INTEGER NOT NULL,           -- VNÄ
    original_price INTEGER,           -- GiÃ¡ gá»‘c (náº¿u cÃ³ giáº£m giÃ¡)
    stock INTEGER DEFAULT 0,          -- Tá»“n kho (0 = pre-order)
    description TEXT,
    short_description VARCHAR(500),
    image_url VARCHAR(500),
    images JSONB DEFAULT '[]',        -- Array of image URLs
    specs JSONB DEFAULT '[]',         -- [{label: "Tá»‘c Ä‘á»™", value: "13.0"}]
    suitable_for JSONB DEFAULT '[]',  -- PhÃ¹ há»£p cho ai
    coach_review TEXT,                -- Nháº­n xÃ©t cá»§a HLV
    is_recommended BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    availability VARCHAR(20) DEFAULT 'in-stock',
    -- 'in-stock', 'pre-order', 'out-of-stock'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Index cho tÃ¬m kiáº¿m
CREATE INDEX idx_shop_products_category ON shop_products(category);
CREATE INDEX idx_shop_products_brand ON shop_products(brand);
CREATE INDEX idx_shop_products_active ON shop_products(is_active);
CREATE INDEX idx_shop_products_slug ON shop_products(slug);

-- =====================================================
-- Báº¢NG SHOP_ORDERS (ÄÆ¡n hÃ ng)
-- =====================================================
CREATE TABLE shop_orders (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_code VARCHAR(20) UNIQUE NOT NULL,
    -- Format: YYYYMMDD + 4 random chars, e.g., "20231218ABCD"
    
    -- ThÃ´ng tin khÃ¡ch hÃ ng
    customer_name VARCHAR(100) NOT NULL,
    customer_phone VARCHAR(20) NOT NULL,
    customer_note TEXT,
    
    -- ThÃ´ng tin thanh toÃ¡n
    total_amount INTEGER NOT NULL,    -- Tá»•ng tiá»n VNÄ
    payment_method VARCHAR(20) NOT NULL DEFAULT 'qr',
    -- 'qr' = QR VietQR, 'bank' = Chuyá»ƒn khoáº£n thá»§ cÃ´ng
    payment_status VARCHAR(20) NOT NULL DEFAULT 'pending',
    -- 'pending' = Chá» thanh toÃ¡n
    -- 'paid' = ÄÃ£ thanh toÃ¡n (khÃ¡ch claim)
    -- 'confirmed' = ÄÃ£ xÃ¡c nháº­n (admin confirm)
    
    -- Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng
    order_status VARCHAR(20) NOT NULL DEFAULT 'new',
    -- 'new' = Má»›i táº¡o
    -- 'processing' = Äang xá»­ lÃ½
    -- 'done' = HoÃ n táº¥t
    -- 'cancelled' = ÄÃ£ huá»·
    
    -- Ná»™i dung chuyá»ƒn khoáº£n (tá»± Ä‘á»™ng sinh)
    transfer_content VARCHAR(50) NOT NULL,
    -- Format: CLBLQD_[order_code]
    
    -- Ghi chÃº admin
    admin_note TEXT,
    confirmed_by UUID REFERENCES admins(id),
    confirmed_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Index
CREATE INDEX idx_shop_orders_code ON shop_orders(order_code);
CREATE INDEX idx_shop_orders_phone ON shop_orders(customer_phone);
CREATE INDEX idx_shop_orders_status ON shop_orders(order_status);
CREATE INDEX idx_shop_orders_payment ON shop_orders(payment_status);
CREATE INDEX idx_shop_orders_created ON shop_orders(created_at DESC);

-- =====================================================
-- Báº¢NG ORDER_ITEMS (Chi tiáº¿t Ä‘Æ¡n hÃ ng)
-- =====================================================
CREATE TABLE shop_order_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES shop_orders(id) ON DELETE CASCADE,
    product_id UUID REFERENCES shop_products(id),
    
    -- LÆ°u snapshot thÃ´ng tin sáº£n pháº©m táº¡i thá»i Ä‘iá»ƒm Ä‘áº·t
    product_name VARCHAR(255) NOT NULL,
    product_brand VARCHAR(100),
    product_price INTEGER NOT NULL,   -- GiÃ¡ táº¡i thá»i Ä‘iá»ƒm Ä‘áº·t
    
    quantity INTEGER NOT NULL DEFAULT 1,
    subtotal INTEGER NOT NULL,        -- price * quantity
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Index
CREATE INDEX idx_shop_order_items_order ON shop_order_items(order_id);
CREATE INDEX idx_shop_order_items_product ON shop_order_items(product_id);

-- =====================================================
-- Báº¢NG SHOP_PAYMENTS (ThÃ´ng tin thanh toÃ¡n)
-- =====================================================
CREATE TABLE shop_payments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    order_id UUID NOT NULL REFERENCES shop_orders(id) ON DELETE CASCADE,
    
    -- ThÃ´ng tin ngÃ¢n hÃ ng (lÆ°u snapshot)
    bank_name VARCHAR(100) NOT NULL,
    bank_code VARCHAR(20) NOT NULL,
    account_number VARCHAR(50) NOT NULL,
    account_holder VARCHAR(100) NOT NULL,
    
    amount INTEGER NOT NULL,
    transfer_content VARCHAR(50) NOT NULL,
    
    -- Báº±ng chá»©ng thanh toÃ¡n (admin upload)
    proof_image_url VARCHAR(500),
    
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    -- 'pending', 'verified', 'rejected'
    
    verified_by UUID REFERENCES admins(id),
    verified_at TIMESTAMP,
    verified_note TEXT,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Index
CREATE INDEX idx_shop_payments_order ON shop_payments(order_id);
CREATE INDEX idx_shop_payments_status ON shop_payments(status);

-- =====================================================
-- Báº¢NG BANK_ACCOUNTS (TÃ i khoáº£n ngÃ¢n hÃ ng CLB)
-- =====================================================
CREATE TABLE shop_bank_accounts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bank_name VARCHAR(100) NOT NULL,
    bank_code VARCHAR(20) NOT NULL,   -- MÃ£ ngÃ¢n hÃ ng cho VietQR
    account_number VARCHAR(50) NOT NULL,
    account_holder VARCHAR(100) NOT NULL,
    is_primary BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert tÃ i khoáº£n máº·c Ä‘á»‹nh
INSERT INTO shop_bank_accounts (bank_name, bank_code, account_number, account_holder, is_primary, is_active)
VALUES ('MB Bank', 'MB', '0937009075', 'VAN HUYNH PHUONG HUY', true, true);
```

## 3ï¸âƒ£ API ENDPOINTS

### Public APIs (KhÃ´ng cáº§n auth)
```
GET    /api/shop/products              - Láº¥y danh sÃ¡ch sáº£n pháº©m
GET    /api/shop/products/:slug        - Chi tiáº¿t sáº£n pháº©m theo slug
GET    /api/shop/products/category/:cat - Lá»c theo danh má»¥c
POST   /api/shop/orders                - Táº¡o Ä‘Æ¡n hÃ ng má»›i
GET    /api/shop/orders/:code          - Tra cá»©u Ä‘Æ¡n hÃ ng (báº±ng mÃ£ + SDT)
GET    /api/shop/bank-info             - Láº¥y thÃ´ng tin ngÃ¢n hÃ ng
GET    /api/shop/qr/:orderCode         - Sinh QR code cho Ä‘Æ¡n hÃ ng
```

### Admin APIs (Cáº§n auth)
```
GET    /api/shop/admin/stats           - Thá»‘ng kÃª dashboard
GET    /api/shop/admin/orders          - Danh sÃ¡ch Ä‘Æ¡n hÃ ng
GET    /api/shop/admin/orders/:id      - Chi tiáº¿t Ä‘Æ¡n hÃ ng
PUT    /api/shop/admin/orders/:id/status - Cáº­p nháº­t tráº¡ng thÃ¡i
PUT    /api/shop/admin/orders/:id/confirm - XÃ¡c nháº­n thanh toÃ¡n

GET    /api/shop/admin/products        - Danh sÃ¡ch sáº£n pháº©m (admin)
POST   /api/shop/admin/products        - ThÃªm sáº£n pháº©m
PUT    /api/shop/admin/products/:id    - Sá»­a sáº£n pháº©m
DELETE /api/shop/admin/products/:id    - XoÃ¡/áº©n sáº£n pháº©m
```

## 4ï¸âƒ£ LOGIC Táº O QR CODE (VietQR)

### VietQR API Format
```javascript
// URL Template:
// https://img.vietqr.io/image/{BANK_CODE}-{ACCOUNT_NO}-{TEMPLATE}.png
//   ?amount={AMOUNT}
//   &addInfo={TRANSFER_CONTENT}
//   &accountName={ACCOUNT_HOLDER}

const generateVietQR = (order) => {
  const bankCode = 'MB';
  const accountNo = '0937009075';
  const accountName = encodeURIComponent('VAN HUYNH PHUONG HUY');
  const amount = order.total_amount;
  const transferContent = encodeURIComponent(`CLBLQD_${order.order_code}`);
  
  // Template: compact, compact2, qr_only, print
  const template = 'compact2';
  
  return `https://img.vietqr.io/image/${bankCode}-${accountNo}-${template}.png?amount=${amount}&addInfo=${transferContent}&accountName=${accountName}`;
};
```

### Order Code Generation
```javascript
const generateOrderCode = () => {
  const date = new Date();
  const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');
  const randomChars = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `${dateStr}${randomChars}`;
  // Example: 20231218ABCD
};
```

## 5ï¸âƒ£ BEST PRACTICES - TRÃNH SAI PHáº M THANH TOÃN

### âœ… AN TOÃ€N & Há»¢P PHÃP
1. **KhÃ´ng giá»¯ tiá»n ngÆ°á»i dÃ¹ng** - Tiá»n chuyá»ƒn trá»±c tiáº¿p vÃ o tÃ i khoáº£n CLB
2. **KhÃ´ng sá»­ dá»¥ng vÃ­ trung gian** - KhÃ´ng Momo, ZaloPay, Stripe
3. **Chá»‰ hiá»ƒn thá»‹ thÃ´ng tin chuyá»ƒn khoáº£n** - KhÃ´ng xá»­ lÃ½ thanh toÃ¡n tá»± Ä‘á»™ng
4. **XÃ¡c nháº­n thá»§ cÃ´ng** - Admin kiá»ƒm tra sao kÃª trÆ°á»›c khi confirm

### âš ï¸ LÆ¯U Ã
1. **Ná»™i dung chuyá»ƒn khoáº£n PHáº¢I ÄÃšNG** - `CLBLQD_[order_code]`
2. **Sá»‘ tiá»n PHáº¢I CHÃNH XÃC** - KhÃ´ng lÃ m trÃ²n
3. **Hotline liÃªn há»‡** - Hiá»ƒn thá»‹ rÃµ rÃ ng náº¿u khÃ¡ch cáº§n há»— trá»£
4. **Thá»i háº¡n thanh toÃ¡n** - ÄÆ¡n hÃ ng cÃ³ thá»ƒ bá»‹ huá»· sau 24h náº¿u chÆ°a thanh toÃ¡n

### ğŸ”’ Báº¢O Máº¬T
1. **Hash hoáº·c giáº¥u sá»‘ Ä‘iá»‡n thoáº¡i** khi tra cá»©u
2. **Rate limiting** cho API táº¡o Ä‘Æ¡n (chá»‘ng spam)
3. **Validate phone format** (Viá»‡t Nam: 10 sá»‘, báº¯t Ä‘áº§u 0)
4. **Admin-only confirm** - Chá»‰ admin xÃ¡c nháº­n thanh toÃ¡n

## 6ï¸âƒ£ CHECKLIST DEPLOY PRODUCTION

### Pre-Deploy
- [ ] Environment variables Ä‘Ã£ set Ä‘Ãºng
- [ ] Database migrations Ä‘Ã£ cháº¡y
- [ ] ThÃ´ng tin ngÃ¢n hÃ ng Ä‘Ã£ cáº­p nháº­t
- [ ] SSL/HTTPS enabled
- [ ] CORS configured Ä‘Ãºng

### Post-Deploy
- [ ] Test táº¡o Ä‘Æ¡n hÃ ng
- [ ] Test sinh QR code
- [ ] Test tra cá»©u Ä‘Æ¡n báº±ng mÃ£ + SÄT
- [ ] Test admin xÃ¡c nháº­n thanh toÃ¡n
- [ ] Test mobile responsive

### Monitoring
- [ ] Logs Ä‘Æ¡n hÃ ng
- [ ] Alert khi cÃ³ Ä‘Æ¡n má»›i
- [ ] Backup database hÃ ng ngÃ y
